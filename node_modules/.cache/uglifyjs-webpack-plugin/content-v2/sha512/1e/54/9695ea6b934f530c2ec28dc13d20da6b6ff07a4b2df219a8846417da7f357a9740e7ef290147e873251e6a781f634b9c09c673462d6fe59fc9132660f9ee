{"code":"!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,\"a\",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p=\"\",s(s.s=0)}([function(e,t,s){\"use strict\";s.r(t);s(1);const i=\"http://localhost:4000/lyrics\",r=\"http://localhost:4000/search\",n=\"http://localhost:4000/rank\",a=\"http://localhost:4000\";function l(e){let t=[].slice.call(e||document.querySelectorAll(\".lazyload\")),s=function(e,t){let s,i;return function r(){let n=Date.now(),a=n-s;!s||a>=t?(e(),s=n):a<t&&(clearTimeout(i),i=setTimeout(r,t-a))}}(function(){if(0===t.length)return window.removeEventListener(\"scroll\",s);(t=t.filter(e=>e.classList.contains(\"lazyload\"))).forEach(function(e){(function(e){let{top:t,left:s,right:i,bottom:r}=e.getBoundingClientRect(),n=document.documentElement.clientWidth,a=document.documentElement.clientHeight;return(t>0&&t<a||r>0&&r<a)&&(s>0&&s<n||i>0&&i<n)})(e)&&function(e){let t=new Image;t.src=e.dataset.src,t.onload=function(){e.src=t.src,e.classList.remove(\"lazyload\")}}(e)})},500);window.addEventListener(\"scroll\",s),window.dispatchEvent(new Event(\"scroll\"))}class o{constructor(e={}){this.$el=e.el,this.sliders=e.sliders,this.interval=e.interval||3e3,this.autoplay=e.autoplay||!0,this.index=0,this.render(),this.start()}render(){this.$el.innerHTML='<div class=\"qq-slider-wrap\"></div>',this.$wrap=this.$el.firstElementChild,this.length=this.$wrap.children.length,this.$wrap.style.width=`${100*this.sliders.length}%`,this.$wrap.innerHTML=this.sliders.map(e=>`\\n                <div class=\"qq-slider-item\">\\n                    <a href=\"${e.link}\">\\n                        <img src=\"${e.image}\" alt=\"\">\\n                    </a>\\n                </div>\\n            `).join(\"\")}start(){setInterval(this.next.bind(this),this.interval)}next(){if(this.index+=1,this.index===this.sliders.length)return this.$wrap.style.transform=\"translate(0)\",void(this.index=0);let e=`-${100*this.index/this.sliders.length}%`;this.$wrap.style.transform=`translate(${e})`}}class h{constructor(e,t){this.$el=e,this.$el.innerHTML='<div class=\"player-lyrics-container\"></div>',this.$lines=this.$el.querySelector(\".player-lyrics-container\"),this.$audio=t,this.text=\"\",this.index=0,this.elapsed=0,this.lyrics=[],this.reset(this.text)}start(){this.pause(),this.intervalId=setInterval(this.upDate.bind(this),1e3)}pause(){clearInterval(this.intervalId)}restart(){this.reset(),this.start()}getSeconds(e){return+e.replace(/^\\[(\\d{2}):(\\d{2}).*/,(e,t,s)=>60*+t+ +s)}upDate(){if(this.elapsed=Math.round(this.$audio.currentTime),this.index===this.lyrics.length-1)return this.reset();for(let e=this.index+1;e<this.lyrics.length;e++){let t=this.getSeconds(this.lyrics[e]);if(this.elapsed===t&&(!this.lyrics[e+1]||this.elapsed<this.getSeconds(this.lyrics[e+1]))){this.$lines.children[this.index].classList.remove(\"active\"),this.$lines.children[e].classList.add(\"active\"),this.index=e;break}}if(this.index>2){let e=-(this.index-2)*this.LINE_HEIGHT;this.$lines.style.transform=`translateY(${e}px)`}}formatText(e){let t=document.createElement(\"div\");return t.innerHTML=e,t.innerText}render(){let e=this.lyrics.map(e=>`\\n        <div class=\"player-lyrics-line\">${e.slice(10)}</div>\\n        `).join(\"\");this.$lines.innerHTML=e}reset(e){this.pause(),this.index=0,this.elapsed=0,e&&(this.text=this.formatText(e)||\"\",this.lyrics=this.text.match(/^\\[\\d{2}:\\d{2}\\.\\d{2}\\](.+)$/gm)||[],this.lyrics.length&&(this.render(),this.$lines.children[this.index].classList.add(\"active\")))}}h.prototype.LINE_HEIGHT=42;class d{constructor(e,t,s){this.$el=e,this.elapsed=0,this.duration=t||0,this.progress=0,this.render(),this.$progress=this.$el.querySelector(\".progress-bar-progress\"),this.$elapsed=this.$el.querySelector(\".progress-elapsed\"),this.$duration=this.$el.querySelector(\".progress-duration\"),this.$elapsed.innerText=this.formatTime(this.elapsed),this.$duration.innerText=this.formatTime(this.duration),s&&this.start()}restart(){this.reset(),this.start()}start(){this.pause(),this.intervalID=setInterval(this.update.bind(this),50)}pause(){clearInterval(this.intervalID)}update(){this.elapsed+=.05,this.elapsed>=this.duration&&this.reset(),this.progress=this.elapsed/this.duration,this.$elapsed.innerText=this.formatTime(this.elapsed),this.$progress.style.transform=`translate(${100*this.progress-100}%)`}reset(e){this.elapsed=0,this.$elapsed.innerText=this.formatTime(this.elapsed),this.$progress.style.transform=\"translateX(-100%)\",this.progress=0,this.pause(),e&&(this.duration=+e,this.$duration.innerText=this.formatTime(this.duration))}render(){this.$el.innerHTML='\\n            <div class=\"progress-time progress-elapsed\">00:00</div>\\n            <div class=\"progress-bar\">\\n                <div class=\"progress-bar-progress\"></div>\\n            </div>\\n            <div class=\"progress-time progress-duration\"></div>\\n        '}formatTime(e){let t=Math.floor(e/60),s=Math.floor(e%60);return t<10&&(t=\"0\"+t),s<10&&(s=\"0\"+s),`${t}:${s}`}}new class{constructor(e){this.$el=e}launch(){return fetch(a).then(e=>e.json()).then(e=>this.render(e)),this}render(e){this.renderslider(e.data.slider),this.renderradios(e.data.radioList),l()}renderslider(e){new o({el:document.querySelector(\"#slider\"),sliders:e.map(function(e){return{link:e.linkUrl,image:e.picUrl.replace(\"http://\",\"https://\")}})})}renderradios(e){this.$el.querySelector(\".radio .list\").innerHTML=e.map(e=>`\\n            <div class=\"list-item\">\\n            <div class=\"list-media\">\\n                <img class=\"lazyload\" data-src=\"${e.picUrl}\"  src=\"${e.picUrl}\" >\\n                <span class=\"icon icon-play\"></span>\\n            </div>\\n            <div class=\"list-title\">${e.Ftitle}</div>\\n        </div>\\n        `).join(\"\")}}(document.querySelector(\".tuijian-view\")).launch(),new class{constructor(e){this.$el=e}launch(){return fetch(n).then(e=>e.json()).then(e=>this.render(e.data.topList)),this}render(e){this.$el.querySelector(\".ranks\").innerHTML=e.map(e=>`\\n               <li class=\"rank-list\">\\n                   <a href=\"\" class=\"rank-item\">\\n                       <div class=\"rank-media\">\\n                           <img class=\"lazyload\" data-src=\"${e.picUrl}\">\\n                       </div>\\n                       <div class=\"rank-detial\">\\n                           <h3 class=\"rank-title\">${e.topTitle}</h3>\\n                           ${this.songlist(e.songList)}\\n                       </div>\\n                   </a>\\n               </li>\\n           `).join(\"\"),l(this.$el.querySelectorAll(\".lazyload\")),this.songlist(e)}songlist(e){return e.map(e=>`\\n            <p class=\"extra\">${e.songname}-<span>${e.singername}</span></p>\\n            `).join(\"\")}}(document.querySelector(\".rank-view\")).launch(),new class{constructor(e){this.$el=e,this.$input=this.$el.querySelector(\"#search_input\"),this.$songs=this.$el.querySelector(\".search-list\"),this.$input.addEventListener(\"keyup\",this.onKeyUp.bind(this)),this.keyword,this.page=1,this.coutn=20,this.songs=[],this.nomore=!1,this.isloading=!1,this.isrenderdsinger=!1,this.onscroll=this.onScroll.bind(this),window.addEventListener(\"scroll\",this.onscroll)}onScroll(){this.nomore||pageYOffset+document.documentElement.clientHeight>document.body.scrollHeight-50&&this.search(this.keyword,this.page+1)}onKeyUp(e){let t=e.target.value.trim();8===e.keyCode&&\"\"===t&&this.reset(),13===e.keyCode&&this.search(t)}search(e,t){if(\"\"===e||void 0===e)return this.reset();this.isloading?this.loading():(this.keyword=e,this.isloading=!0,fetch(function(e,t=1){return`${r}?keyword=${e}&page=${t}`}(this.keyword,t||this.page)).then(e=>e.json()).then(e=>(this.page=e.data.song.curpage,this.nomore=\"no results\"===e.message||\"query error\"===e.message,this.songs.push(...e.data.song.list),e.data.song.list)).then(e=>this.append(e)).then(()=>{this.isloading=!1,this.loaded()}).catch(()=>{this.isloading=!1,this.loaded()}))}reset(){this.keyword=\"\",this.page=1,this.songs=[],this.$songs.innerHTML=\"\"}append(e){let t=e.map(e=>`\\n            <li class=\"search-item\">\\n                <a href=\"#player?artist=${e.singer.map(e=>e.name).join(\"-\")}&songid=${e.songid}&songname=${e.songname}&albummid=${e.albummid}&duration=${e.interval}&songmid=${e.songmid}\">\\n                    <div class=\"search-media\">\\n                        <span></span>\\n                    </div>\\n                    <div class=\"search-content\">\\n                        <h6>${decodeURI(e.songname)}</h6>\\n                        <p>${e.singer.map(e=>decodeURI(e.name)).join(\" / \")}</p>\\n                    </div>\\n                </a>\\n            </li>\\n        `).join(\"\");this.$songs.insertAdjacentHTML(\"beforeend\",t)}loading(){this.$el.querySelector(\".loading\").classList.remove(\"hide\"),this.$el.querySelector(\".loading\").classList.add(\"active\")}loaded(){this.$el.querySelector(\".loading\").classList.add(\"hide\"),this.$el.querySelector(\".loading\").classList.remove(\"active\")}}(document.querySelector(\".search-view\"));let c=new class{constructor(e){this.$el=e,this.$el.addEventListener(\"click\",this),this.$audio=this.createAutio(),this.lyrics=new h(this.$el.querySelector(\".player-lyrics\"),this.$audio),this.progress=new d(this.$el.querySelector(\".progress\"),280)}play(e={}){if(!e)return;this.$el.querySelector(\".song-name\").innerText=decodeURI(e.songname),this.$el.querySelector(\".song-artist\").innerText=decodeURI(e.artist),this.progress.reset(e.duration);let t=`https://y.gtimg.cn/music/photo_new/T002R300x300M000${e.albummid}.jpg?max_age=2592000`;var s;this.$el.querySelector(\".album-cover\").style.backgroundImage=`url(${t})`,this.$el.querySelector(\".player-background\").style.backgroundImage=`url(${t})`,e.songid&&(this.songid=e.songid,this.$audio.src=`http://dl.stream.qqmusic.qq.com/C400${e.songmid}.m4a?guid=3877936752&vkey=00529634851596500510C15140EBD5876A51F3D637B63DC7FBD2C67CFDE5C2EDAA58E739213C1E7883B6AA9EBDC1FD262F7897182C4F75CA&uin=0&fromtag=38`,fetch((s=this.songid,`${i}?songid=${s}`)).then(e=>e.json()).then(e=>e.lyric).then(e=>this.lyrics.reset(e)).catch(()=>{})),this.show()}handleEvent(e){let t=e.target;switch(!0){case t.matches(\".icon-play\"):this.onPlay(e);break;case t.matches(\".icon-pause\"):this.onPause(e);break;case t.matches(\".icon-list\"):this.hide()}}onPlay(e){this.$audio.play(),this.lyrics.start(),this.progress.start(),e.target.classList.add(\"icon-pause\"),e.target.classList.remove(\"icon-play\")}onPause(e){this.$audio.pause(),this.lyrics.pause(),this.progress.pause(),e.target.classList.add(\"icon-play\"),e.target.classList.remove(\"icon-pause\")}createAutio(){let e=document.createElement(\"audio\");return e.addEventListener(\"ended\",()=>{this.$audio.play(),this.lyrics.restart(),this.progress.restart()}),document.body.appendChild(e),e}playing(){this.$el.querySelector(\".player-header>span\").classList.add(\"icon-pause\"),this.$el.querySelector(\".player-header>span\").classList.remove(\"icon-play\")}pausing(){this.$el.querySelector(\".player-header>span\").classList.add(\"icon-play\"),this.$el.querySelector(\".player-header>span\").classList.remove(\"icon-pause\")}show(){this.$el.classList.add(\"show\"),document.body.classList.add(\"noscroll\")}hide(){this.$el.classList.remove(\"show\"),document.body.classList.remove(\"noscroll\")}}(document.querySelector(\"#player\"));function u(){let e=location.hash;if(/^#player\\?.+/.test(e)){let t=e.slice(e.indexOf(\"?\")+1).match(/(\\w+)=([^&]+)/g),s=t&&t.reduce((e,t)=>{let s=t.split(\"=\");return e[s[0]]=s[1],e},{});c.play(s),c.lyrics.restart(),c.progress.reset(s.duration),c.pausing()}else c.hide()}document.querySelector(\"#header .btn\").addEventListener(\"click\",()=>{c.show()}),u(),window.addEventListener(\"hashchange\",u)},function(e,t){document.addEventListener(\"click\",function(e){let t=e.target,s=document.querySelector(t.dataset.view);\"tab\"===t.dataset.role&&([].forEach.call(t.parentElement.children,function(e){e.classList.remove(\"active\")}),t.classList.add(\"active\"),s&&([].forEach.call(s.parentElement.children,e=>{e.style.display=\"none\"}),s.style.display=\"block\"))})}]);","extractedComments":[]}